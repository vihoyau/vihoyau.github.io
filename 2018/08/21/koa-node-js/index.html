<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="总结一下koa">
<meta property="og:type" content="article">
<meta property="og:title" content="koa-node.js">
<meta property="og:url" content="https://github.com/vihoyau/qiuweihao.git/2018/08/21/koa-node-js/index.html">
<meta property="og:site_name" content="开源技术栈">
<meta property="og:description" content="总结一下koa">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-08-21T02:30:40.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="koa-node.js">
<meta name="twitter:description" content="总结一下koa">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://github.com/vihoyau/qiuweihao.git/2018/08/21/koa-node-js/"/>





  <title>koa-node.js | 开源技术栈</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开源技术栈</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">技术分享</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/vihoyau/qiuweihao.git/2018/08/21/koa-node-js/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="邱伟豪">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开源技术栈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">koa-node.js</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-21T09:25:49+08:00">
                2018-08-21
              </time>
            

            

            
            

          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>总结一下koa<br><a id="more"></a></p>
<h1 id="koa2开始"><a href="#koa2开始" class="headerlink" title="koa2开始"></a>koa2开始</h1><p>  async/await 使用<br>  快速上手理解<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">getSyncTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      let startTime = <span class="keyword">new</span> Date().getTime()</span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        let endTime = <span class="keyword">new</span> Date().getTime()</span><br><span class="line">        let data = endTime - startTime</span><br><span class="line">        resolve( data )</span><br><span class="line">      &#125;, <span class="number">500</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( err ) &#123;</span><br><span class="line">      reject( err )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">async function getSyncData() &#123;</span><br><span class="line">  let time = await getSyncTime()</span><br><span class="line">  let data = `endTime - startTime = $&#123;time&#125;`</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line">async function getData() &#123;</span><br><span class="line">  let data = await getSyncData()</span><br><span class="line">  console.<span class="built_in">log</span>( data )</span><br><span class="line">&#125;</span><br><span class="line">getData()</span><br></pre></td></tr></table></figure></p>
<p>从代码中可以找到<br>异步-&gt;同步  底层返回一个promise   可以替代callback</p>
<h1 id="koa-结构"><a href="#koa-结构" class="headerlink" title="koa 结构"></a>koa 结构</h1><p><a href="https://github.com/koajs/koa/">https://github.com/koajs/koa/</a><br>开源中的源码结构<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── lib</span><br><span class="line">│   ├── application.js</span><br><span class="line">│   ├── context.js</span><br><span class="line">│   ├── request.js</span><br><span class="line">│   └── response.js</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure></p>
<p>application 核心中间件处理流程。入口文件<br>context  上下文<br>request http 请求<br>response 处理http响应</p>
<h1 id="koa2特性"><a href="#koa2特性" class="headerlink" title="koa2特性"></a>koa2特性</h1><p>只提供封装好http上下文，请求，响应，以及基于async/await的中间件容器</p>
<h1 id="koa中间件开发"><a href="#koa中间件开发" class="headerlink" title="koa中间件开发"></a>koa中间件开发</h1><p>async 中间件开发<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">log</span><span class="params">( ctx )</span> </span>&#123;</span><br><span class="line">    console.<span class="built_in">log</span>( ctx.method, ctx.header.host + ctx.url )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">module</span>.exports = function () &#123;</span><br><span class="line">  <span class="keyword">return</span> async function ( ctx, next ) &#123;</span><br><span class="line">    <span class="built_in">log</span>(ctx);</span><br><span class="line">    <span class="function">await <span class="title">next</span><span class="params">()</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="koa原生路由实现"><a href="#koa原生路由实现" class="headerlink" title="koa原生路由实现"></a>koa原生路由实现</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require('koa')</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use( async ( ctx ) =&gt; &#123;</span><br><span class="line">  let url = ctx.request.url</span><br><span class="line">  ctx.body = url</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<h1 id="koa-router"><a href="#koa-router" class="headerlink" title="koa-router"></a>koa-router</h1><p><a href="https://github.com/ChenShenhai/koa2-note/tree/master/demo/route-use-middleware">https://github.com/ChenShenhai/koa2-note/tree/master/demo/route-use-middleware</a><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require('koa')</span><br><span class="line">const fs = require('fs')</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">const Router = require('koa-router')</span><br><span class="line">let home = <span class="keyword">new</span> Router()</span><br><span class="line"><span class="comment">// 子路由1</span></span><br><span class="line">home.get(<span class="string">'/'</span>, async ( ctx )=&gt;&#123;</span><br><span class="line">  let html = `</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href=<span class="string">"/page/helloworld"</span>&gt;/page/helloworld&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href=<span class="string">"/page/404"</span>&gt;/page/<span class="number">404</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  `</span><br><span class="line">  ctx.body = html</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 子路由2</span></span><br><span class="line">let page = <span class="keyword">new</span> Router()</span><br><span class="line">page.get('/404', async ( ctx )=&gt;&#123;</span><br><span class="line">  ctx.body = '404 page!'</span><br><span class="line">&#125;).get('/helloworld', async ( ctx )=&gt;&#123;</span><br><span class="line">  ctx.body = 'helloworld page!'</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 装载所有子路由</span></span><br><span class="line">let router = <span class="keyword">new</span> Router()</span><br><span class="line">router.use(<span class="string">'/'</span>, home.routes(), home.allowedMethods())</span><br><span class="line">router.use('/page', page.routes(), page.allowedMethods())</span><br><span class="line"><span class="comment">// 加载路由中间件</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods())</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  console.log('[demo] route-use-middleware is starting at port 3000')</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h1 id="请求数据获取"><a href="#请求数据获取" class="headerlink" title="请求数据获取"></a>请求数据获取</h1><ul>
<li><p>get请求<br><a href="https://github.com/ChenShenhai/koa2-note/blob/master/demo/request/get.js">https://github.com/ChenShenhai/koa2-note/blob/master/demo/request/get.js</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require('koa')</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use( async ( ctx ) =&gt; &#123;</span><br><span class="line">  let url = ctx.url</span><br><span class="line">  <span class="comment">// 从上下文的request对象中获取</span></span><br><span class="line">  let request = ctx.request</span><br><span class="line">  let req_query = request.query</span><br><span class="line">  let req_querystring = request.querystring</span><br><span class="line">  <span class="comment">// 从上下文中直接获取</span></span><br><span class="line">  let ctx_query = ctx.query</span><br><span class="line">  let ctx_querystring = ctx.querystring</span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    url,</span><br><span class="line">    req_query,</span><br><span class="line">    req_querystring,</span><br><span class="line">    ctx_query,</span><br><span class="line">    ctx_querystring</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  console.log('[demo] request get is starting at port 3000')</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>post请求<br><a href="https://github.com/ChenShenhai/koa2-note/blob/master/demo/request/post.js">https://github.com/ChenShenhai/koa2-note/blob/master/demo/request/post.js</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解析上下文里node原生请求的POST参数</span></span><br><span class="line"><span class="function">function <span class="title">parsePostData</span><span class="params">( ctx )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      let postdata = <span class="string">""</span>;</span><br><span class="line">      ctx.req.addListener('data', (data) =&gt; &#123;</span><br><span class="line">        postdata += data</span><br><span class="line">      &#125;)</span><br><span class="line">      ctx.req.addListener(<span class="string">"end"</span>,function()&#123;</span><br><span class="line">        let parseData = parseQueryStr( postdata )</span><br><span class="line">        resolve( parseData )</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( err ) &#123;</span><br><span class="line">      reject(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将POST请求参数字符串解析成JSON</span></span><br><span class="line">function parseQueryStr( queryStr ) &#123;</span><br><span class="line">  let queryData = &#123;&#125;</span><br><span class="line">  let queryStrList = queryStr.split(<span class="string">'&amp;'</span>)</span><br><span class="line">  console.<span class="built_in">log</span>( queryStrList )</span><br><span class="line">  <span class="keyword">for</span> (  let [ index, queryStr ] of queryStrList.entries()  ) &#123;</span><br><span class="line">    let itemList = queryStr.split(<span class="string">'='</span>)</span><br><span class="line">    queryData[ itemList[<span class="number">0</span>] ] = decodeURIComponent(itemList[<span class="number">1</span>])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> queryData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>koa-bodyparser中间件<br><a href="https://github.com/ChenShenhai/koa2-note/blob/master/demo/request/post-middleware.js">https://github.com/ChenShenhai/koa2-note/blob/master/demo/request/post-middleware.js</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require('koa')</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">const bodyParser = require('koa-bodyparser')</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用ctx.body解析中间件</span></span><br><span class="line">app.use(bodyParser())</span><br><span class="line">app.use( async ( ctx ) =&gt; &#123;</span><br><span class="line">  if ( ctx.url === '/' &amp;&amp; ctx.method === 'GET' ) &#123;</span><br><span class="line">    <span class="comment">// 当GET请求时候返回表单页面</span></span><br><span class="line">    let html = `</span><br><span class="line">      &lt;h1&gt;koa2 request post demo&lt;/h1&gt;</span><br><span class="line">      &lt;form method=<span class="string">"POST"</span> action=<span class="string">"/"</span>&gt;</span><br><span class="line">        &lt;p&gt;userName&lt;/p&gt;</span><br><span class="line">        &lt;input name=<span class="string">"userName"</span> /&gt;&lt;br/&gt;</span><br><span class="line">        &lt;p&gt;nickName&lt;/p&gt;</span><br><span class="line">        &lt;input name=<span class="string">"nickName"</span> /&gt;&lt;br/&gt;</span><br><span class="line">        &lt;p&gt;email&lt;/p&gt;</span><br><span class="line">        &lt;input name=<span class="string">"email"</span> /&gt;&lt;br/&gt;</span><br><span class="line">        &lt;button type=<span class="string">"submit"</span>&gt;submit&lt;/button&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">    `</span><br><span class="line">    ctx.body = html</span><br><span class="line">  &#125; else if ( ctx.url === '/' &amp;&amp; ctx.method === 'POST' ) &#123;</span><br><span class="line">    <span class="comment">// 当POST请求的时候，中间件koa-bodyparser解析POST表单里的数据，并显示出来</span></span><br><span class="line">    let postData = ctx.request.body</span><br><span class="line">    ctx.body = postData</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 其他请求显示404</span></span><br><span class="line">    ctx.body = '&lt;h1&gt;404！！！ o(╯□╰)o&lt;/h1&gt;'</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  console.log('[demo] request post is starting at port 3000')</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="原生koa2实现静态资源服务器"><a href="#原生koa2实现静态资源服务器" class="headerlink" title="原生koa2实现静态资源服务器"></a>原生koa2实现静态资源服务器</h1><p><a href="https://github.com/ChenShenhai/koa2-note/blob/master/demo/static-server/">https://github.com/ChenShenhai/koa2-note/blob/master/demo/static-server/</a><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">├── <span class="keyword">static</span> # 静态资源目录</span><br><span class="line">│   ├── css/</span><br><span class="line">│   ├── image/</span><br><span class="line">│   ├── js/</span><br><span class="line">│   └── index.html</span><br><span class="line">├── util # 工具代码</span><br><span class="line">│   ├── content.js # 读取请求内容</span><br><span class="line">│   ├── dir.js # 读取目录内容</span><br><span class="line">│   ├── file.js # 读取文件内容</span><br><span class="line">│   ├── mimes.js # 文件类型列表</span><br><span class="line">│   └── walk.js # 遍历目录内容</span><br><span class="line">└── index.js # 启动入口文件</span><br></pre></td></tr></table></figure></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require('koa')</span><br><span class="line">const path = require('path')</span><br><span class="line">const content = require('./util/content')</span><br><span class="line">const mimes = require('./util/mimes')</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="comment">// 静态资源目录对于相对入口文件index.js的路径</span></span><br><span class="line">const staticPath = './static'</span><br><span class="line"><span class="comment">// 解析资源类型</span></span><br><span class="line"><span class="function">function <span class="title">parseMime</span><span class="params">( url )</span> </span>&#123;</span><br><span class="line">  let extName = path.extname( url )</span><br><span class="line">  extName = extName ?  extName.slice(1) : 'unknown'</span><br><span class="line">  <span class="keyword">return</span>  mimes[ extName ]</span><br><span class="line">&#125;</span><br><span class="line">app.use( async ( ctx ) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 静态资源目录在本地的绝对路径</span></span><br><span class="line">  let fullStaticPath = path.join(__dirname, staticPath)</span><br><span class="line">  <span class="comment">// 获取静态资源内容，有可能是文件内容，目录，或404</span></span><br><span class="line">  let _content = await content( ctx, fullStaticPath )</span><br><span class="line">  <span class="comment">// 解析请求内容的类型</span></span><br><span class="line">  let _mime = parseMime( ctx.url )</span><br><span class="line">  <span class="comment">// 如果有对应的文件类型，就配置上下文的类型</span></span><br><span class="line">  <span class="keyword">if</span> ( _mime ) &#123;</span><br><span class="line">    ctx.type = _mime</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 输出静态资源内容</span></span><br><span class="line">  if ( _mime &amp;&amp; _mime.indexOf('image/') &gt;= 0 ) &#123;</span><br><span class="line">    <span class="comment">// 如果是图片，则用node原生res，输出二进制数据</span></span><br><span class="line">    ctx.res.writeHead(<span class="number">200</span>)</span><br><span class="line">    ctx.res.write(_content, 'binary')</span><br><span class="line">    ctx.res.end()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 其他则输出文本</span></span><br><span class="line">    ctx.body = _content</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line">console.log('[demo] static-server is starting at port 3000')</span><br></pre></td></tr></table></figure>
<h1 id="koa-static-中间件"><a href="#koa-static-中间件" class="headerlink" title="koa-static 中间件"></a>koa-static 中间件</h1><p><a href="https://github.com/ChenShenhai/koa2-note/blob/master/demo/static-use-middleware/">https://github.com/ChenShenhai/koa2-note/blob/master/demo/static-use-middleware/</a><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require('koa')</span><br><span class="line">const path = require('path')</span><br><span class="line">const static = require('koa-static')</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="comment">// 静态资源目录对于相对入口文件index.js的路径</span></span><br><span class="line">const staticPath = './static'</span><br><span class="line">app.use(<span class="keyword">static</span>(</span><br><span class="line">  path.join( __dirname,  staticPath)</span><br><span class="line">))</span><br><span class="line">app.use( async ( ctx ) =&gt; &#123;</span><br><span class="line">  ctx.body = 'hello world'</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  console.log('[demo] static-use-middleware is starting at port 3000')</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h1 id="koa2使用cookie"><a href="#koa2使用cookie" class="headerlink" title="koa2使用cookie"></a>koa2使用cookie</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require('koa')</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use( async ( ctx ) =&gt; &#123;</span><br><span class="line">  if ( ctx.url === '/index' ) &#123;</span><br><span class="line">    ctx.cookies.<span class="built_in">set</span>(</span><br><span class="line">      'cid', </span><br><span class="line">      'hello world',</span><br><span class="line">      &#123;</span><br><span class="line">        domain: 'localhost',  // 写cookie所在的域名</span><br><span class="line">        path: '/index',       // 写cookie所在的路径</span><br><span class="line">        maxAge: <span class="number">10</span> * <span class="number">60</span> * <span class="number">1000</span>, <span class="comment">// cookie有效时长</span></span><br><span class="line">        expires: new Date('2017-02-15'),  // cookie失效时间</span><br><span class="line">        httpOnly: <span class="literal">false</span>,  <span class="comment">// 是否只用于http请求中获取</span></span><br><span class="line">        overwrite: <span class="literal">false</span>  <span class="comment">// 是否允许重写</span></span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    ctx.body = 'cookie is ok'</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ctx.body = 'hello world' </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  console.log('[demo] cookie is starting at port 3000')</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="koa2实现session"><a href="#koa2实现session" class="headerlink" title="koa2实现session"></a>koa2实现session</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require('koa')</span><br><span class="line">const session = require('koa-session-minimal')</span><br><span class="line">const MysqlSession = require('koa-mysql-session')</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="comment">// 配置存储session信息的mysql</span></span><br><span class="line">let store = <span class="keyword">new</span> MysqlSession(&#123;</span><br><span class="line">  user: 'root',</span><br><span class="line">  password: 'abc123',</span><br><span class="line">  database: 'koa_demo',</span><br><span class="line">  host: '127.0.0.1',</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 存放sessionId的cookie配置</span></span><br><span class="line">let cookie = &#123;</span><br><span class="line">  maxAge: '', // cookie有效时长</span><br><span class="line">  expires: '',  // cookie失效时间</span><br><span class="line">  path: '', // 写cookie所在的路径</span><br><span class="line">  domain: '', // 写cookie所在的域名</span><br><span class="line">  httpOnly: '', // 是否只用于http请求中获取</span><br><span class="line">  overwrite: '',  // 是否允许重写</span><br><span class="line">  secure: '',</span><br><span class="line">  sameSite: '',</span><br><span class="line">  signed: '',</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用session中间件</span></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">  key: 'SESSION_ID',</span><br><span class="line">  store: store,</span><br><span class="line">  cookie: cookie</span><br><span class="line">&#125;))</span><br><span class="line">app.use( async ( ctx ) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 设置session</span></span><br><span class="line">  if ( ctx.url === '/set' ) &#123;</span><br><span class="line">    ctx.session = &#123;</span><br><span class="line">      user_id: Math.random().toString(<span class="number">36</span>).substr(<span class="number">2</span>),</span><br><span class="line">      count: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    ctx.body = ctx.session</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( ctx.url === <span class="string">'/'</span> ) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取session信息</span></span><br><span class="line">    ctx.session.count = ctx.session.count + <span class="number">1</span></span><br><span class="line">    ctx.body = ctx.session</span><br><span class="line">  &#125; </span><br><span class="line">&#125;) </span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line">console.log('[demo] session is starting at port 3000')</span><br></pre></td></tr></table></figure>
<h1 id="koa2加载模板引擎"><a href="#koa2加载模板引擎" class="headerlink" title="koa2加载模板引擎"></a>koa2加载模板引擎</h1><p><a href="https://github.com/ChenShenhai/koa2-note/blob/master/demo/ejs/">https://github.com/ChenShenhai/koa2-note/blob/master/demo/ejs/</a><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">├── package.json</span><br><span class="line">├── index.js</span><br><span class="line">└── view</span><br><span class="line">    └── index.ejs</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require('koa')</span><br><span class="line">const views = require('koa-views')</span><br><span class="line">const path = require('path')</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="comment">// 加载模板引擎</span></span><br><span class="line">app.use(views(path.join(__dirname, './view'), &#123;</span><br><span class="line">  extension: 'ejs'</span><br><span class="line">&#125;))</span><br><span class="line">app.use( async ( ctx ) =&gt; &#123;</span><br><span class="line">  let title = 'hello koa2'</span><br><span class="line">  await ctx.render('index', &#123;</span><br><span class="line">    title,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<h1 id="文件上传-busboy模块、异步上传图片"><a href="#文件上传-busboy模块、异步上传图片" class="headerlink" title="文件上传 busboy模块、异步上传图片"></a>文件上传 busboy模块、异步上传图片</h1><p><a href="https://github.com/ChenShenhai/koa2-note/tree/master/demo/upload-async">https://github.com/ChenShenhai/koa2-note/tree/master/demo/upload-async</a><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── index.js # 后端启动文件</span><br><span class="line">├── node_modules</span><br><span class="line">├── package.json</span><br><span class="line">├── <span class="keyword">static</span> # 静态资源目录</span><br><span class="line">│   ├── image # 异步上传图片存储目录</span><br><span class="line">│   └── js</span><br><span class="line">│       └── index.js # 上传图片前端js操作</span><br><span class="line">├── util</span><br><span class="line">│   └── upload.js # 后端处理图片流操作</span><br><span class="line">└── view</span><br><span class="line">    └── index.ejs <span class="meta"># ejs后端渲染模板</span></span><br></pre></td></tr></table></figure></p>
<h1 id="创建数据库会话"><a href="#创建数据库会话" class="headerlink" title="创建数据库会话"></a>创建数据库会话</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const mysql      = require('mysql')</span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">  host     : '127.0.0.1',   // 数据库地址</span><br><span class="line">  user     : 'root',    // 数据库用户</span><br><span class="line">  password : '123456'   // 数据库密码</span><br><span class="line">  database : 'my_database'  // 选中数据库</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 执行sql脚本对数据库进行读写 </span></span><br><span class="line">connection.query('SELECT * FROM my_table',  (error, results, fields) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">throw</span> error</span><br><span class="line">  <span class="comment">// connected! </span></span><br><span class="line">  <span class="comment">// 结束会话</span></span><br><span class="line">  connection.release() </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="async-await封装使用mysql"><a href="#async-await封装使用mysql" class="headerlink" title="async/await封装使用mysql"></a>async/await封装使用mysql</h1><ul>
<li>promise 封装./async-db<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const mysql = require('mysql')</span><br><span class="line"><span class="keyword">const</span> pool = mysql.createPool(&#123;</span><br><span class="line">  host     :  '127.0.0.1',</span><br><span class="line">  user     :  'root',</span><br><span class="line">  password :  '123456',</span><br><span class="line">  database :  'my_database'</span><br><span class="line">&#125;)</span><br><span class="line">let query = function( sql, values ) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Promise(( resolve, reject ) =&gt; &#123;</span><br><span class="line">    pool.getConnection(function(err, connection) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        reject( err )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        connection.query(sql, values, ( err, rows) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> ( err ) &#123;</span><br><span class="line">            reject( err )</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resolve( rows )</span><br><span class="line">          &#125;</span><br><span class="line">          connection.release()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">module</span>.exports = &#123; query &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>async/await 使用<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const &#123; query &#125; = require('./async-db')</span><br><span class="line"><span class="function">async function <span class="title">selectAllData</span><span class="params">( )</span> </span>&#123;</span><br><span class="line">  let sql = 'SELECT * FROM my_table'</span><br><span class="line">  let dataList = await query( sql )</span><br><span class="line">  <span class="keyword">return</span> dataList</span><br><span class="line">&#125;</span><br><span class="line">async function getData() &#123;</span><br><span class="line">  let dataList = await selectAllData()</span><br><span class="line">  console.<span class="built_in">log</span>( dataList )</span><br><span class="line">&#125;</span><br><span class="line">getData()</span><br></pre></td></tr></table></figure></p>
<h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><p><a href="https://github.com/ChenShenhai/koa2-note/blob/master/demo/jsonp/">https://github.com/ChenShenhai/koa2-note/blob/master/demo/jsonp/</a><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是否为JSONP的请求 </span></span><br><span class="line"> if ( ctx.method === 'GET' &amp;&amp; ctx.url.split('?')[0] === '/getData.jsonp') &#123;</span><br><span class="line">   <span class="comment">// 获取jsonp的callback</span></span><br><span class="line">   let callbackName = ctx.query.callback || 'callback'</span><br><span class="line">   let returnData = &#123;</span><br><span class="line">     success: <span class="literal">true</span>,</span><br><span class="line">     data: &#123;</span><br><span class="line">       text: 'this is a jsonp api',</span><br><span class="line">       time: <span class="keyword">new</span> Date().getTime(),</span><br><span class="line">     &#125;</span><br><span class="line">   &#125; </span><br><span class="line">   <span class="comment">// jsonp的script字符串</span></span><br><span class="line">   let jsonpStr = `;$&#123;callbackName&#125;($&#123;JSON.stringify(returnData)&#125;)`</span><br><span class="line">   <span class="comment">// 用text/javascript，让请求支持跨域获取</span></span><br><span class="line">   ctx.type = 'text/javascript'</span><br><span class="line">   <span class="comment">// 输出jsonp字符串</span></span><br><span class="line">   ctx.body = jsonpStr</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><p>比较出名的有mocha，karma，jasmine等<br><a href="https://github.com/ChenShenhai/koa2-note/blob/master/demo/test-unit/">https://github.com/ChenShenhai/koa2-note/blob/master/demo/test-unit/</a></p>
<h1 id="开发debug"><a href="#开发debug" class="headerlink" title="开发debug"></a>开发debug</h1><p><a href="https://github.com/ChenShenhai/koa2-note/blob/master/demo/start-quick/">https://github.com/ChenShenhai/koa2-note/blob/master/demo/start-quick/</a></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/weixinpay.jpg" alt="邱伟豪 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="邱伟豪 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
    
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/20/asus/" rel="next" title="asus">
                <i class="fa fa-chevron-left"></i> asus
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zODg0Ny8xNTM3NQ"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">邱伟豪</p>
              <p class="site-description motion-element" itemprop="description">后端 前端 运维 js java ngnix 区块链</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#koa2开始"><span class="nav-number">1.</span> <span class="nav-text">koa2开始</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#koa-结构"><span class="nav-number">2.</span> <span class="nav-text">koa 结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#koa2特性"><span class="nav-number">3.</span> <span class="nav-text">koa2特性</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#koa中间件开发"><span class="nav-number">4.</span> <span class="nav-text">koa中间件开发</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#koa原生路由实现"><span class="nav-number">5.</span> <span class="nav-text">koa原生路由实现</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#koa-router"><span class="nav-number">6.</span> <span class="nav-text">koa-router</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#请求数据获取"><span class="nav-number">7.</span> <span class="nav-text">请求数据获取</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#原生koa2实现静态资源服务器"><span class="nav-number">8.</span> <span class="nav-text">原生koa2实现静态资源服务器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#koa-static-中间件"><span class="nav-number">9.</span> <span class="nav-text">koa-static 中间件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#koa2使用cookie"><span class="nav-number">10.</span> <span class="nav-text">koa2使用cookie</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#koa2实现session"><span class="nav-number">11.</span> <span class="nav-text">koa2实现session</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#koa2加载模板引擎"><span class="nav-number">12.</span> <span class="nav-text">koa2加载模板引擎</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#文件上传-busboy模块、异步上传图片"><span class="nav-number">13.</span> <span class="nav-text">文件上传 busboy模块、异步上传图片</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建数据库会话"><span class="nav-number">14.</span> <span class="nav-text">创建数据库会话</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#async-await封装使用mysql"><span class="nav-number">15.</span> <span class="nav-text">async/await封装使用mysql</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#跨域"><span class="nav-number">16.</span> <span class="nav-text">跨域</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#单元测试"><span class="nav-number">17.</span> <span class="nav-text">单元测试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开发debug"><span class="nav-number">18.</span> <span class="nav-text">开发debug</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
 <span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
  <span class="author" itemprop="copyrightHolder">邱伟豪</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  

  
</body>
</html>
